<!DOCTYPE html>
<html class="wide wow-animation" lang="en">
  <head>
    <title>智游天下-旅游规划助手</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width height=device-height initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,400i,500,600,700,800%7CBaloo">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/fonts.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        #chat-box {
            height: 600px;       
            width: 80%;          
            max-width: 600px;    
            border-style: solid; 
            overflow-y: scroll;  
            overflow-x: hidden;  
            word-wrap: break-word;  
            padding: 10px;       
            border-width: var(--block-border-width);
            margin: 0 auto;      
        }
    </style>
  </head>
  <body>
    <div class="preloader">
      <div class="preloader-inner">
        <div class="preloader-top">
          <div class="preloader-top-sun">
            <div class="preloader-top-sun-bg"></div>
            <div class="preloader-top-sun-line preloader-top-sun-line-0"></div>
            <div class="preloader-top-sun-line preloader-top-sun-line-45"></div>
            <div class="preloader-top-sun-line preloader-top-sun-line-90"></div>
            <div class="preloader-top-sun-line preloader-top-sun-line-135"></div>
            <div class="preloader-top-sun-line preloader-top-sun-line-180"></div>
            <div class="preloader-top-sun-line preloader-top-sun-line-225"></div>
            <div class="preloader-top-sun-line preloader-top-sun-line-270"></div>
            <div class="preloader-top-sun-line preloader-top-sun-line-315"></div>
          </div>
        </div>
        <div class="preloader-bottom">
          <div class="preloader-bottom-line preloader-bottom-line-lg"></div>
          <div class="preloader-bottom-line preloader-bottom-line-md"></div>
          <div class="preloader-bottom-line preloader-bottom-line-sm"></div>
          <div class="preloader-bottom-line preloader-bottom-line-xs"></div>
        </div>
      </div>
    </div>
    <div class="page">
      <!-- Page Header-->
      <header class="section page-header">
        <!-- RD Navbar-->
        <div class="rd-navbar-wrap">
          <nav class="rd-navbar rd-navbar-classic" data-layout="rd-navbar-fixed" data-sm-layout="rd-navbar-fixed" data-md-layout="rd-navbar-fixed" data-md-device-layout="rd-navbar-fixed" data-lg-layout="rd-navbar-static" data-lg-device-layout="rd-navbar-fixed" data-xl-layout="rd-navbar-static" data-xl-device-layout="rd-navbar-static" data-lg-stick-up-offset="1px" data-xl-stick-up-offset="1px" data-xxl-stick-up-offset="1px" data-lg-stick-up="true" data-xl-stick-up="true" data-xxl-stick-up="true">
            <div class="rd-navbar-main-outer">
              <div class="rd-navbar-main">
                <!-- RD Navbar Panel-->
                <div class="rd-navbar-panel">
                  <!-- RD Navbar Toggle-->
                  <button class="rd-navbar-toggle" data-rd-navbar-toggle=".rd-navbar-nav-wrap"><span></span></button>
                  <!-- RD Navbar Brand-->
                  <div class="rd-navbar-brand">
                    <!--Brand--><a class="brand" href="index.html"><img class="brand-logo-dark" src="images/zytxlog.jpg" alt="" width="146" height="29"/><img class="brand-logo-light" src="images/logo-inverse-292x59.png" alt="" width="146" height="29"/></a>
                  </div>
                </div>
                <div class="rd-navbar-nav-wrap">
                  <ul class="rd-navbar-nav">
                    <li class="rd-nav-item active"><a class="rd-nav-link" href="index.html">旅行规划助手</a>
                    </li>
                    <li class="rd-nav-item"><a class="rd-nav-link" href="about.html">旅游问答助手</a>
                    </li>
                    <li class="rd-nav-item"><a class="rd-nav-link" href="destinations.html">智游用户社区</a>
                  </ul>
                </div>
                <div class="rd-navbar-collapse-outer context-light">
                </div>
              </div>
            </div>
            <div class="rd-navbar-placeholder"></div>
          </nav>
        </div>
      </header>
      <div class="basicInfo formPanel">
        <h2 class="formPanel-title">开始你的个性化旅行</h2>
        <ul class="formPanel-list clearfix">
          <li class="formPanel-item">
            <label>出发地</label>
            <div class="input-wrap">
              <input type="text" placeholder="请输入您的出发地" id="departure">
              <p class="tips warning" style="display:none;">请输入您的出发地</p>
            </div>
          </li>
          <li class="formPanel-item formPanel-item-right">
            <label>目的地</label>
            <div class="input-wrap">
              <input type="text" placeholder="请输入您的目的地" id="destination">
              <p class="tips warning" style="display:none;">请输入您的目的地</p>
            </div>
          </li>
          <li class="formPanel-item">
            <label>出发日期</label>
            <div class="input-wrap">
              <input type="text" placeholder="请输入出发日期" id="date">
              <p class="tips warning" style="display:none;">请输入出发日期</p>
            </div>
          </li>
          <li class="formPanel-item formPanel-item-right">
            <label>游玩天数</label>
            <div class="input-wrap">
              <input type="text" placeholder="请输入游玩天数" id="days">
              <p class="tips warning" style="display:none;">请输入游玩天数</p>
            </div>
          </li>
          <li class="formPanel-item">
            <label>出行人数</label>
            <div class="input-wrap">
              <input type="text" placeholder="请输入出行人数" id="people">
              <p class="tips warning" style="display:none;">请输入出行人数</p>
            </div>
          </li>
          <li class="formPanel-item formPanel-item-right">
            <label>人均预算</label>
            <div class="input-wrap">
              <input type="text" placeholder="请输入人均预算" id="budget">
              <p class="tips warning" style="display:none;">请输入人均预算</p>
            </div>
          </li>
          <!-- <li class="formPanel-item formPanel-item-right">
            <label>个性化要求</label>
            <div class="input-wrap">
              <input type="text" placeholder="请输入个性化要求" name="departure">
              <p class="tips warning" style="display:none;">请输入个性化要求</p>
            </div>
          </li> -->
          <li class="formPanel-item">
            <input type="button" class="resultbutton" value="一键生成" onclick="generatePlan()">
          </li>
        </ul>
      </div>
      <h3>旅游行程规划表：</h3>
      <div id="chat-box" class="block svelte-12cmxck">
        <div class="wrapper svelte-nab2ao">
          <label class="svelte-1b6s6s float">
            <span class="svelte-1b6s6s"></span>
            "聊天窗口"
          </label>
          <div class="bubble-wrap svelte-1ggj411 placeholder-container" role="log" aria-label="chatbot conversation" aria-live="polite">
            <div class="message-wrap svelte-1ggj411"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="snackbars" id="form-output-global"></div>
    <script src="js/core.min.js"></script>
    <script src="js/script.js"></script>
<script>
    function generatePlan() {
        const departure = document.getElementById('departure').value;
        const destination = document.getElementById('destination').value;
        const date = document.getElementById('date').value;
        const days = document.getElementById('days').value;
        const people = document.getElementById('people').value;
        const budget = document.getElementById('budget').value;

        console.log("Input values:", {
            departure: departure,
            destination: destination,
            date: date,
            days: days,
            people: people,
            budget: budget
        });

        const tripData = {
            departure: departure,
            destination: destination,
            date: date,
            days: days,
            people: people,
            budget: budget
        };

        fetch('/plan_trip', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(tripData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                // 显示错误信息
                console.error("错误信息:", data.messages);
                data.messages.forEach(message => {
                  addMessage(`错误信息: ${message}`, 'bot-message');
              });
            } else {
                // 显示 AI 回复
                const aiResponse = data.ai_response;
                const recommendations = data.recommendations;
                addMessage(`AI 回复: ${aiResponse}`, 'bot-message');
                recommendations.forEach(rec => {
                    addMessage(`<strong>${rec['景点名称']}</strong>: ${rec['简介']}`, 'bot-message');
                });
            }
        })
        .catch(error => console.error('Error:', error));
    }


    function addMessage(message, className) {
        const chatbox = document.getElementById('chat-box');
        const messageElement = document.createElement('div');
        messageElement.className = `message ${className}`;
        messageElement.innerHTML = formatMessage(message);
        chatbox.appendChild(messageElement);
        chatbox.scrollTop = chatbox.scrollHeight;  // 自动滚动到最底部
    }
    function formatMessage(message) {
    // 使用HTML标签进行格式化，例如使用<p>标签和缩进样式
    return message.split('\n').map(line => `<p style="text-indent: 2em;">${line}</p>`).join('');
    }
</script>
</body>
</html>
